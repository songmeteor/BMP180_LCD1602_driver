# STM32 기반 BMP180 & LCD1602 드라이버 구현

📄 **프로젝트 문서**: [BMP180 & LCD1602 driver 구현 노션 링크](https://lopsided-tray-d39.notion.site/BMP180-LCD1602-driver-1ce04872d73a802c9e0fc2f30998089c)

<br>

## 📌 프로젝트 개요

STM32F407 MCU를 기반으로 BMP180 센서를 통해 측정한 온도와 기압을 LCD1602에 4bit 모드로 출력하는 시스템을 구현.  
BMP180의 보정 계수 및 측정 알고리즘을 데이터시트 기반으로 직접 구현하였고, I2C 통신 및 LCD 타이밍에 대한 이해를 바탕으로 드라이버를 완성함.

<br>

## 🎯 주요 기능

| 구성 요소 | 설명 |
|-----------|------|
| 🧭 **BMP180 드라이버** | I2C 기반 센서 드라이버 직접 구현, 보정계수/UT/UP 읽기 및 보정 연산 |
| ⏱️ **Timeout 처리** | HAL I2C 함수 실패 시 timeout 조건 직접 설정 |
| 🔠 **LCD1602 출력** | 4bit 모드로 GPIO 제어하여 문자 출력 |
| 🧮 **고정 소수점 연산** | 부동소수점 대신 정수 연산으로 온도/기압 보정값 계산 |
| 📉 **오실로스코프 분석** | Enable 신호 파형 및 타이밍 확인하여 안정성 확보 |

<br>

## 🔌 하드웨어 구성

| 구성 요소 | 설명 |
|-----------|------|
| **MCU** | STM32F407 |
| **센서** | BMP180 (I2C 기반) |
| **LCD** | LCD1602 (4bit GPIO 제어) |
| **I2C 핀** | PB8 (SCL), PB9 (SDA) |
| **LCD 제어 핀** | D4~D7 (PB4~PB7), RS/RW/E (PB0~PB2) |

<br>

## 🔧 드라이버 구성

### 📍 BMP180

- EEPROM에서 보정 계수(AC1~MD) 읽기  
- `UT`, `UP` 읽은 후 온도/기압 보정 연산 수행  
- 보정 공식은 datasheet 기반으로 구현

### 📍 LCD1602

- Enable 신호 펄스 폭 ≥ 140ns 확보를 위해 20us 딜레이 적용  
- RS/RW 제어 및 8bit 데이터를 두 번 나눠 전송 (4bit 모드)  
- 커서 이동, 문자열 출력, 화면 초기화 기능 포함

<br>

## 🧪 디버깅 및 해결

| 문제 | 해결 방법 |
|------|-----------|
| `HAL_I2C_Mem_Read()` 실패 | I2C 주소를 **Write 주소(0xEE)** 로 지정해야 정상 동작 |
| Enable 신호 타이밍 오류 | 1us로는 불안정, 20us 지연으로 안정성 확보 |
| LCD 표시 깨짐 | 초기화 순서 재정비 및 설정 명령 재확인 |

<br>

## 📂 주요 소스 구조

| 파일명 | 설명 |
|--------|------|
| `bmp180.c/h` | BMP180 센서 드라이버 (I2C 통신 및 보정계수 처리) |
| `lcd1602_4bit.c/h` | LCD1602 4bit 모드 제어 함수 |
| `main.c` | 센서 데이터 읽고 LCD 출력 |
| `delay_us.c` | 마이크로초 단위 지연 함수 |

<br>

## 🖥️ 출력 결과 예시

- `LCD Line 1` : `Temp = 25°C`  
- `LCD Line 2` : `Pres = 1015hPa`

<br>

## 📸 회로도

- BMP180 → I2C1(PB8, PB9)  
- LCD1602 → 4bit GPIO 제어 (PB0~PB7)

<br>

## 📊 오실로스코프 분석

- Enable 신호 펄스 시간 확보  
- 데이터 쓰기 안정성 확보 확인

<br>

## 🧠 핵심 포인트 요약

- `HAL_I2C_Mem_Read()`는 내부적으로 Write → Read 방식이므로 **쓰기 주소 사용 필수**  
- BMP180은 보정계수가 센서마다 달라 반드시 **초기화 과정에서 읽어야 정확한 측정 가능**  
- LCD Enable 펄스 타이밍이 짧으면 글자 출력이 깨지므로 **충분한 딜레이 확보 필요**
